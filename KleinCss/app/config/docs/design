B&C Platform 项目设计文档
一、概述
本文档旨在阶段性描述网站设计的结构、功能，并作为第一节点工作基础, 根据项目的推进，设计文档进一步增补。
二、第一层设计
1.技术路线
数据库：mongodb。
后端：nodejs。
前端表现层:页面表现层HTML，数据接口表现层json（web、ios、android交互）。
服务器：反向代理服务器采用Nginx（负载均衡）。

2.框架结构
后端框架：nodejs(支撑，CMD)，express（web, MVC分层），ejs(模板,view)，mongoose（数据库连接）。
前端框架：requirejs(AMD), backbone(前端MVC)。
3.网站结构设计
（1）首页：第一访问地址。链接课程搜索、教师搜索、机构搜索、注册页面。链接置顶课程、老师、机构相应的页面。
（2）课程搜索：链接首页、教师搜索、机构搜索、注册页面，链接课程详情页面。
（3）教师搜索：链接首页、课程搜索、机构搜索、注册页面，链接教师详情页面。
（4）机构搜索：链接首页、课程搜索、教师搜索、注册页面，链接机构详情页面。
（5）注册搜索：依次跳转注册、基础信息填写、认证信息填写、提交审核
（6）用户中心：链接首页、课程搜索、教师搜索、机构搜索。
（7）具体化的某个课程、教师、机构详细页面。（被链接）
4.功能结构设计
（1）显式功能
首页：网站logo、介绍，导航，登陆、注册接口。
课程搜索：课程搜索，登陆用户收藏课程、报名参加课程。
教师搜索：教师搜索、登陆用户收藏教师。
机构搜索：机构搜索、登陆用户收藏机构。
注册：注册为普通用户，认证为教师、机构。
用户中心：
用户分为普通用户、教师用户、机构用户、管理员用户。
a.普通用户：信息维护，信息查看，课程、老师、机构评价。
b.教师用户：包含普通用户功能，课程管理、发布，课程授权。
c.机构用户：包含普通用户功能，课程管理、发布，教师管理。
（2）审核功能
	 用户上传图片审核，用户认证信息审核，课程审核，审核任务队列，审核消息队列。
（3）评价功能
	 用户评价课程、教师、机构，评价系统产生的数据作为网站内容的搜索条件之一。
（4）支费功能：支付宝、微信支付，待定
（5）用户管理：用户角色、权限分级。
（6）管理员：报表、网站监控，待定。
三、第二层设计
1.路由设计（Router）
首页路由：/， /index
课程搜索路由：/cources， /cources/index
教师搜索路由：/teachers， /teachers/index
机构搜索路由：/agencies，/agences/index
注册路由：/register
用户中心路由：/users/center
2.功能设计
2.1首页
a)  内容：导航条，巨幕，快速登录，注册，网站介绍，精品课程，金牌老师，资深机构，留影墙，合作伙伴，footer(版权)。
b)  处理方式：静态化处理，首页所有内容不访问数据库。
2.2 精品课程
a) 搜索条件：（表现形式：slider）评分，价格，授课方式，收费方式，名称搜索；
b) 搜索结果列表;
2.3 金牌老师
a)搜索条件：（表现形式：slider）评分，星级，学位，名称；
b)搜索结果列表
2.4 资深机构
a)搜索条件：
b)搜索结果列表
2.5用户注册
	现在用户注册只支持邮箱和手机注册登录。
2.5.1注册
选择邮箱注册，输入邮箱和密码之后,点击邮箱验证，发送验证码给相应的邮箱，用户输入验证码信息，注册确认按钮可以点击。如果验证码未输入正确，则提示验证码错误信息。

选择手机注册，输入手机和密码之后，点击收取验证码，发送短信至手机，收取验证码，输入验证码信息，注册确认按钮可以点击。如果验证码未输入正确，则提示验证码错误信息。

注册时，如果邮箱或者手机已经在数据库中存在，则相应提示用户已经”**已经被注册”。
2.5.2角色选择
注册之后提示是否进行角色的选择，如果不进入角色的选择，则默认为学员（既普通账号），进入角色的选择，可以选择教师和机构用户（一个机构用户既代表一个机构）。

默认学员的用户中心功能只有主页、课程日历、我的课程、我的作业、我的收藏、我的展示、基础设置，不需要验证。
教师的用户中心功能有主页、课程日历、课程维护、我的课程、我的学生、学生作业、我的收藏、我的展示、认证信息、设置。
机构用户的用户中心功能有主页、课程日历、旗下课程、旗下老师、收藏、机构展示、认证信息、设置。
其中红色的这些功能在必须是选择教师或者机构用户的信息在认证之后，并且审核通过的用户才可操作，其他未认证的用户功能至灰色或者不可见。
2.5.3身份认证
2.5.3.1 教师注册认证
教师注册身份认证的时候，真实姓名、国籍、证件类型、证件号码、证件照片、收款方式（待认定），这几个选项为必填项。
教师在填写完这些信息之后，点击提交审核，并且由管理员在后台确认审核通过之后上述1.2中的红色功能才能属于可使用状态。
2.5.3.2 机构基本认证
机构用户在认证的时候需要填入机构名称、法人代表、注册号、成立日期、营业期限、营业执照照片，法人代表证件信息，法人代表证件照片。
机构用户在填写完这些信息之后，点击提交审核，并且由管理员在后台确认审核通过之后上述1.2中的红色功能才能属于可使用状态。
2.5.4 信息完善
在用户选择完身份或者身份认证之后，在弹出的确认框中都给与一个信息完善的跳转链接，如果点击信息完善这时候自动给用户实现登录，并且跳到用户中心的通用信息维护设置界面。


2.6用户登录
2.6.1 用户登录
	用户输入手机或者邮箱、密码进行登录，后台自动进行手机或者邮箱的匹配登录，当密码和手机或者邮箱都符合的时候，才可以进行登录，并且将用户登录信息放到session, 并且自动跳到用户中心的主页。
2.6.2注册链接、
	跳到注册页面进行注册，进行功能1的操作。
2.6.3 忘记密码
	点击进入忘记密码功能页面，用户需选择手机或者邮箱进行验证，做完验证并且符合验证要求，给与输入新密码的页面并且修改密码。
2.7.用户中心
2.7.1 通用信息维护
	通用信息维护界面包括基础信息、安全设置、消息中心和帮助中心四个功能模块。
2.7.1.1 基础信息
	基础信息包括昵称、头像、真实姓名、国籍、性别、生日、所在城市
	输入上述信息之后，点击保存完成基础信息的修改。
2.7.1.2 安全设置
安全设置里面包含手机绑定、邮箱绑定、修改密码、找回密码(找回密码这个功能我个人觉得在安全设置里面不需要)。
手机未绑定的用户可以通过手机验证码进行绑定。
邮箱未绑定的用户可以跟邮箱验证进行绑定。
修改密码的时候需要输入旧密码，两次新密码，当旧密码正确并且两次新密码一样的时候，才可以修改密码。
找回密码，需要向你已经绑定的手机或者邮箱进行一个验证之后，输入两次新密码，
当验证成功或者验证码输入正确和两次新密码输入一致之后，修改其密码。
2.7.1.3 消息中心
  教师消息中心来源分析
1）老师创建的课程在被审核时候，发送一条信息。（样式：xx老师，您的课程名称(id)正在被审核）。
2）老师的课程审核完毕的时候，(不管成功失败)发送一条信息。（样式：xx老师，您的课程名称(id)审核成功or失败，失败加原因）。
3）学生订购了老师的课程，发送一条信息。（样式：xx老师，您的课程名称(id)已经被xx学生订购）。
4) 老师的课程过期。（样式：xx老师，您的课程名称(id)已经过期，被下降，如果需重新发布，请前往过期课程处理）。
5）老师的被机构分派课程。（样式：xx老师，xx机构给您安排了课程名称（id））。
6）登录的时候发送最近的一条授课记录信息给老师。（样式：xx老师，您最近的一节授课为xxxx时候xx地点给XX授课）。
2.7.1.4 帮助中心
	帮助中心可分为注册、登录、安全设置、意见反馈。
	意见反馈这表可以进行对平台意见的反馈。管理员可以在后台设置默认回复改信息。并且可以手动回复该信息。
2.7.2 普通用户
	暂缺。
2.7.3 教师用户
2.7.3.1 个人中心首页
教师个人中心首页包含三个tab页：消息列表，课程日历，所有课程概览；用户头像，作业审批，最近一次教学安排

消息列表：
按时间排序，从上至下，显示与教师相关的消息提示，课程收藏，本人关注，打分：
头像（链接个人主页）xx点赞了我，时间；
头像（链接个人主页）xx收藏了我的课程xx，时间；
头像（链接个人主页）xx给xx课程打了分，时间；
课程日历：
默认没有数据展示，教师可以把和学生双方确认的课程和时间制作课程日历；
显示当月的课程日历，每天默认显示三个课程，多余三个课程，提示课程数；
单元格单击调出当天课程列表，课程名称，时间，地点，双击可以修改。
所有课程概览：
	显示已发布的所有课程概览列表
	课程图片，名称，状态（未开课进行中已结束），学生数，分数等。
头像：
老师上传的头像。
作业审批：
等待批阅，已经批阅，链接到学生作业。
最进一次教学安排：
课程名称时间地点
2.7.3.2课程维护
Ⅰ概述
		通过课程维护管理新建和课程的发表等工作。
Ⅱ流程
		课程维护的大体流程（如图7.3.2.1）：

图7.3.2.1
Ⅲ概要设计
⒈课程信息
	录入一些基本信息，定义收费方式和授课方式，选择面对群体等。
	1）.基本信息
	录入一些基本信息：课程名称、课程简介、课程详情、课程大纲（目录）等。
	2）.收费模式
	①标准收费：按课程总数、单节课单价、单节课时长、优惠总价；
  ②按小时收费：单价/小时。
  3）.授课方式
教室授课、上门授课、网上远程授课、一对一、一对多等方式。
  4）.是否授权
授权机构、授权时间、授权价格等。
2.未发布课程
新建课程保持后，课程状态进入未审核。这时管理员开始审核课程，由于审核数量有限，一些课程进入等待状态。
1）.未审核
	课程保存，但未开始审核。
2）.等待审核
已经提交审核，但是由于工作量积压，课程进入等待审核状态。
3）.审核中
管理员针对上传课程的真实性、原创性等进行审核。
4）.审核完成
	审核完，对于审核通过的课程进行发布，未通过的课程，返回到用户的未审核状态并标记未审核。
3.已发布课程
新建课程保持后，课程状态进入未审核。这时管理员开始审核课程，由于审核数量有限，一些课程进入等待状态。
1）.未开课
	课程尚未开课，等待学生报名中。
2）.进行中
课程已经开始，可以进行学生统计、查询课程进度等。
①学生统计：统计正在上课的学生；
②课程进度：查看课程的进度；
③作业审批：老师布置的一些作业，老师批阅结果可以录入显示。
3）.已下架
已经授完课，结束的课程，可以再次开启或者删除等。

2.7.3.3 我的学生
	使用Tab页对正在授课和曾经授课进行切换

正在授课
列表展示正在上课的学生信息，点击后链接至学生主页，显示学生此课程的作业和打卡情况。

曾经授课
列表展示曾经上过课的学生信息，链接至学生主页，显示学生此课程的作业和打卡情况。

2.7.3.4 学生作业
使用Tab页对等待批阅和已经批阅进行切换

等待批阅
对等待批阅的作业批阅打分，打分完成后，归类为已经批阅的作业。

已经批阅
列表展示已经打分批阅完成后的作业

2.7.3.5 我的收藏
使用tab对收藏的课程、老师和机构进行切换

课程
	收藏的课程以列表形式展示，点击后连接至所收藏的课程。

老师
	收藏的老师以列表形式显示，点击后跳转至老师公开主页。

机构
	收藏的机构以列表形式显示，点击后跳转至机构主页。

2.7.3.6个人公开信息维护
个人公开信息维护包括母语信息、擅长语言、擅长课程、个人介绍（用于搜索显示）。
其中每个选项都可以勾选来表示是否需要显示在搜索页面上或者主页。

2.7.3.7 教师认证信息维护
在认证信息提交之后与数据库原有的工作认证进行匹配，信息一致且没新证件照片的时候则不需要再发送给给管理员验证信息，如果有新的学历变更和新证件照片上传的话，则必须要将改动的信息发送给后台进行验证。
教师可补充的认证信息为学历认证、工作历史认证，荣誉资质认证。
A) 学历认证包括学士，硕士，博士选择和学位证的图片上传。
B) 工作历史认证包括工作历史经验的文本书写。
C) 荣誉资质认证包括荣誉奖项书写和荣誉资质图片上传。
2.7.4 机构用户
暂缺。
2.7.5 管理员用户
暂缺。

3.数据模型设计（Schema， Model）
#符号说明
# #:描述
# $:字段
# ->:数据demo
# []:collection

#一 用户
#1.用户 [users]
#唯一标识 uuid
$id
#昵称
$name
#邮箱
$email
#手机
$phone
#密码 md5
$password
$age
$sex
#国籍
$nationality
#生日
$birth
#是否可用(是否被管理员禁用)， 1可用 0不可用
$enable
#用户类型 0普通 1老师 2机构 3审核员 4.管理员
$usertype
-> {type:0,declare:'普通用户'}
#头像 (需要审核)
$portrait
#所在城市
$city


#2.用户扩展一 老师认证 [tcreds]
#唯一标识 uuid
$id
#用户唯一标识
$userid

#---基础认证信息---
#真实姓名
$name
#身份证件类型 （credentials）
$credentype
#身份证件号码
$credencode
#身份证件照片
$credenimage
#收款方式
$payway

###补充认证信息###
#学历认证 (certificate) {学位, 证件照片, 证件号码}
$acadecerti
->
{
  level:0,  //0学士以下 1学士 2硕士 3博士 ...
  image:'',
  code:''
}
#资质认证 {荣誉资质说明, 证书照片}
$servexerti
->
{
  info:''
  image:''
}
#工作历史认证
$workexp

#个人其他信息 json
->[{fname:mothertongue, fdetail:母语,:fvalue:英语，pub:是否公开}, ......]



#3.用户扩展二 机构认证 待定 [acreds]


#4.认证信息审核队列 [cremsgs]
#唯一标识 uuid
$identify
#用户唯一标识
$userid
#审核类型 身份审核， 头像审核
#审核内容 json {}
#审核状态
#提交日期
#审核完成日期

#二 课程
#1.课程 [courses]
#唯一标识 uuid
id
#课程名称
$name
#简介
$introduction
#详情
$info
#大纲、目录
$catalog
#计费方式 json
$billing
->
{
  type:{
    fvalue:1
    fdetail:标准
  },
  info:{
    total:10,
    duration:60min

  }
}
#单价
$price
#授课方式 0教室授课，1上门授课，2网上远程授课
$method

#授课地点 (教室授课方式指定的地点 其他授课方式不需要)
$classroom
#授课模式 0一对一 1一对多
$mode
#面向群体年龄
$range
->{min:10, max:16}
#缩略图 (资源路径)
$thumbnail
#图片 (资源路径)
$image
#课程评分 (接收程度。。。。)
$score
#课程点赞
$comment
#可用状态 (老师删除掉的课程状态不可用 0不可用 1可用)
$enable

#----审核信息----
#创建日期
$cdate
#审核状态 0未审核 1等待审核 2审核中 3审核成功 4审核失败
$checkstate
#发布状态 0未发布 1已发布 2已下架
$pubstate
->
{
  type:0,
  name:'未发布'
}
#进行状态 0未开课 1进行中 2已结束
$actstate

#2.课程关系
#2.1老师与课程关系 [tcrels] teacher-course
#老师id
$teacherid
#关系 （0拥有,1创建 ?待定）
$relation
->
{
  type:0,
  name:'拥有'
}
#课程id
$courceid

#2.2学生与课程关系 [ucrels] user-course
#学生id
$userid
#关系 (收藏 报名 上课 学完)
$relation
#课程id
$courceid
#老师ID
$teacherid

#状态
$state
#2.3机构与课程关系 [acrels] agency-course
待定

#3.老师学生关系 [turels] teacher-user
#主体 主题唯一标识
$subjectid
#关系 0教学关系 1收藏关系
$relation
->
{
  type:0,
  name:'教学关系'
}
#客体 客体唯一标识
$objectid
#状态 教学关系（0正在授课 1曾经授课）
$state
->
{
  type:0,
  name:'正在授课'
}

#4.作业 [homeworks]
#唯一标识 uuid
$id
#老师id
$teacherid
#课程id
$courseid
#作业内容(具体pdf文档地址或者内容 homework content)
$hwcontent
#作业标题 (homework title)
$hwtitle

#5 作业学生关系 [hwrels] homework relation
#唯一标识 uuid
$indentity
#学生id
$userid
#作业id
$hwid
#学生上传的作业内容
$hwcontent
#教师评分
$score

#6 消息队列 [msgs] message queue
#消息唯一标识
$id
#消息对象id
$objid
#消息内容
$content
#创建时间
$cdate
 

#7 课程日历节点 [calnodes] calendar nodes
#日历节点唯一标识 uuid
$id
#授课时间
$tdate
#老师
$teacherid
#课程id
$courseid
#课程缩略信息 json
$coursethumb
->{
  name:'',
  introduction:'',
  catalog:''
}
#节点状态 (0未上课，1已上课)
$state
